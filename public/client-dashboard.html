<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Dashboard - AI Booking Concierge</title>
    <style>
        :root {
            --primary: #5c6ac4;
            --secondary: #3a4a9f;
            --success: #1b5e20;
            --warning: #f5a623;
            --danger: #c62828;
            --light: #f7f9fc;
            --dark: #1f2234;
            --card-shadow: 0 8px 24px rgba(16, 26, 62, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #eef2ff 0%, #e3ebff 40%, #fef9ff 100%);
            color: #2b2e3b;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 20px 60px;
        }

        .header {
            background: rgba(255, 255, 255, 0.96);
            border-radius: 20px;
            padding: 28px 32px;
            box-shadow: var(--card-shadow);
            border-left: 6px solid var(--primary);
        }

        .client-info {
            display: flex;
            justify-content: space-between;
            gap: 24px;
            flex-wrap: wrap;
            align-items: center;
        }

        .client-brand {
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .client-logo {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: #fff;
            background: var(--primary);
        }

        .client-details h1 {
            font-size: 2.2rem;
            color: var(--primary);
        }

        .client-details p {
            color: #6f7390;
            font-size: 1rem;
            margin-top: 4px;
        }

        .status-chip {
            padding: 10px 20px;
            border-radius: 999px;
            font-weight: 600;
            background: rgba(92, 106, 196, 0.1);
            color: var(--primary);
        }

        .client-meta {
            margin-top: 18px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }

        .meta-item {
            background: var(--light);
            border-radius: 12px;
            padding: 12px 16px;
        }

        .meta-label {
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            color: #8c8fab;
            margin-bottom: 4px;
        }

        .meta-value {
            font-weight: 600;
            color: #2f3147;
        }

        .demo-banner {
            margin-top: 18px;
            padding: 14px 18px;
            border-radius: 14px;
            background: #fff8e1;
            border-left: 4px solid #f5a623;
            color: #7a4f00;
            display: none;
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 18px;
            margin: 30px 0;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.96);
            border-radius: 18px;
            padding: 18px;
            box-shadow: var(--card-shadow);
            text-align: center;
        }

        .status-card h4 {
            text-transform: uppercase;
            letter-spacing: 0.15em;
            font-size: 0.75rem;
            color: #8c8fab;
            margin-bottom: 10px;
        }

        .status-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 22px;
        }

        .card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 18px;
            padding: 22px;
            box-shadow: var(--card-shadow);
        }

        .card h3 {
            margin-bottom: 18px;
            font-size: 1.2rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f1f3fb;
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #616484;
        }

        .metric-value {
            font-weight: 600;
            color: var(--primary);
        }

        .leads-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 320px;
            overflow-y: auto;
        }

        .lead-item {
            border: 1px solid #eef0fb;
            border-radius: 12px;
            padding: 14px;
            background: #f9f9ff;
        }

        .lead-name {
            font-weight: 600;
            color: #2f3147;
        }

        .lead-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #7b7f9f;
            margin-top: 6px;
        }

        .lead-status {
            display: inline-block;
            margin-top: 8px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            background: rgba(92, 106, 196, 0.12);
            color: var(--primary);
        }

        .chart {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            height: 180px;
            padding: 8px 6px;
        }

        .chart-bar {
            flex: 1;
            border-radius: 8px 8px 4px 4px;
            background: linear-gradient(180deg, rgba(92,106,196,0.85), rgba(58,74,159,0.85));
            position: relative;
        }

        .chart-bar::after {
            content: attr(data-label);
            position: absolute;
            bottom: -22px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.85rem;
            color: #8c8fab;
        }

        .chart-value {
            text-align: center;
            margin-top: 8px;
            font-size: 0.9rem;
            color: #616484;
        }

        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .activity-item {
            padding: 14px 16px;
            border-radius: 12px;
            border: 1px solid #ecefff;
            background: #fbfbff;
        }

        .activity-item strong {
            color: #2f3147;
        }

        .activity-meta {
            margin-top: 4px;
            color: #8b8fb0;
            font-size: 0.9rem;
        }

        .workflow-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .workflow-step {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .workflow-icon {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            background: rgba(92,106,196,0.12);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .client-info {
                flex-direction: column;
                align-items: flex-start;
            }
            .status-bar {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="client-info">
                <div class="client-brand">
                    <div class="client-logo" id="clientLogo">‚ú®</div>
                    <div class="client-details">
                        <h1 id="clientName">Demo Booking Partner</h1>
                        <p id="clientDescription">Real-time follow-up + booking dashboard</p>
                        <p id="clientTagline">We chase every lead you already paid for and land them on your calendar.</p>
                    </div>
                </div>
                <div class="status-chip" id="clientStatus">Live</div>
            </div>

            <div class="client-meta" id="clientMeta">
                <div class="meta-item">
                    <div class="meta-label">Phone</div>
                    <div class="meta-value" id="metaPhone">+44 20 3880 1234</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Timezone</div>
                    <div class="meta-value" id="metaTimezone">Europe/London</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Coverage</div>
                    <div class="meta-value" id="metaHours">8am - 8pm, 7 days/week</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Industry</div>
                    <div class="meta-value" id="metaIndustry">AI Booking Concierge</div>
                </div>
            </div>

            <div class="demo-banner" id="demoBanner">
                <strong>Demo environment:</strong> This sandbox mirrors the live dashboard your clients see. We just preload it with mock data for Looms.
            </div>
        </header>

        <section class="status-bar">
            <div class="status-card">
                <h4>Total Leads</h4>
                <div class="status-value" id="statusTotalLeads">48</div>
            </div>
            <div class="status-card">
                <h4>AI Calls Logged</h4>
                <div class="status-value" id="statusTotalCalls">36</div>
            </div>
            <div class="status-card">
                <h4>Conversion Rate</h4>
                <div class="status-value" id="statusConversionRate">63%</div>
            </div>
            <div class="status-card">
                <h4>First Response</h4>
                <div class="status-value" id="statusFirstResponse">2m 58s</div>
            </div>
        </section>

        <section class="dashboard-grid">
            <article class="card">
                <h3>üìà Recent Activity</h3>
                <div id="recent-activity">
                    <div class="metric-row">
                        <span class="metric-label">New leads (24h)</span>
                        <span class="metric-value">7</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Calls completed</span>
                        <span class="metric-value">21</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Appointments booked</span>
                        <span class="metric-value">12</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Avg response speed</span>
                        <span class="metric-value">2m 58s</span>
                    </div>
                </div>
            </article>

            <article class="card">
                <h3>üß© Lead Priority</h3>
                <div id="lead-priority">
                    <div class="metric-row">
                        <span class="metric-label">High priority</span>
                        <span class="metric-value">9</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Medium</span>
                        <span class="metric-value">14</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Low</span>
                        <span class="metric-value">7</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Avg lead score</span>
                        <span class="metric-value">87</span>
                    </div>
                </div>
            </article>

            <article class="card">
                <h3>üë• Recent Leads</h3>
                <div id="leads-list" class="leads-list"></div>
            </article>

            <article class="card">
                <h3>üìä Weekly Performance</h3>
                <div id="performance-chart">
                    <div class="chart" id="chartBars"></div>
                    <p class="chart-value" id="chartSummary">18 bookings in the last 7 days</p>
                </div>
            </article>

            <article class="card">
                <h3>‚öôÔ∏è System Status</h3>
                <div id="system-status">
                    <div class="metric-row">
                        <span class="metric-label">Lead number</span>
                        <span class="metric-value" id="statusPhone">+44 20 3880 1234</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">SMS & WhatsApp</span>
                        <span class="metric-value">Active</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Calendar sync</span>
                        <span class="metric-value">Connected</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Pipeline coverage</span>
                        <span class="metric-value" id="statusCoverage">7 days/week</span>
                    </div>
                </div>
            </article>

            <article class="card" style="grid-column: 1 / -1;">
                <h3>üóìÔ∏è Latest Conversations</h3>
                <div id="recent-calls" class="activity-feed"></div>
            </article>

            <article class="card" style="grid-column: 1 / -1;">
                <h3>üìã How We Run This For You</h3>
                <ul id="workflow" class="workflow-list"></ul>
            </article>
        </section>
    </div>

    <script>
        const DEMO_CLIENT_KEY = 'demo_client';
        const BASE_URL = window.location.origin;

        const CLIENT_CONFIG = {
            demo_client: {
                name: 'Demo Booking Partner',
                description: 'Live sandbox showing the AI concierge following up + booking',
                tagline: 'Upload existing leads ‚Üí AI calls in minutes ‚Üí appointments land in your calendar.',
                logo: '‚ú®',
                status: 'Demo Live',
                phone: '+44 20 3880 1234',
                timezone: 'Europe/London',
                businessHours: '8am - 8pm, 7 days/week',
                industry: 'AI Booking Concierge',
                workflow: [
                    { icon: 'üì•', title: 'Import leads', desc: 'We pull directly from your CRM, forms, or spreadsheets.' },
                    { icon: 'ü§ñ', title: 'AI speed-to-lead', desc: 'Calls + SMS go out within minutes (24/7 coverage).' },
                    { icon: 'üìÖ', title: 'Bookings land in calendar', desc: 'Confirmed appointments drop straight into your calendar.' },
                    { icon: 'üìä', title: 'Daily digest', desc: 'Slack/email summary with leads touched and outcomes.' }
                ],
                chart: [5, 7, 6, 9, 8, 10, 7]
            }
        };

        const DEMO_DATA = {
            totalLeads: 48,
            totalCalls: 36,
            last24hLeads: 7,
            conversionRate: 63,
            successRate: 84,
            firstResponse: '2m 58s',
            avgLeadScore: 87,
            highPriorityLeads: 9,
            mediumPriorityLeads: 14,
            lowPriorityLeads: 7,
            recentLeads: [
                { name: 'Jordan Hale', phone: '+44 7700 900451', service: 'AI Strategy Session', status: 'Booked', timeAgo: '2 min ago' },
                { name: 'Priya Desai', phone: '+44 7700 900512', service: 'Follow-up Call', status: 'Awaiting reply', timeAgo: '9 min ago' },
                { name: 'Lewis Grant', phone: '+44 7700 900623', service: 'Pricing Review', status: 'Engaged', timeAgo: '25 min ago' },
                { name: 'Emily Carr', phone: '+44 7700 900734', service: 'Calendar Integration', status: 'Left voicemail', timeAgo: '40 min ago' }
            ],
            serviceMix: [
                { name: 'Lead Follow-Up', percent: 35, notes: 'Speed-to-lead flows' },
                { name: 'Appointment Booking', percent: 45, notes: 'AI calendar concierge' },
                { name: 'Calendar Integration', percent: 20, notes: 'Multi-calendar sync' }
            ],
            recentCalls: [
                { name: 'Sarah Patel', summary: 'Booked Tuesday 2:30pm', channel: 'AI call', timeAgo: '2 min ago' },
                { name: 'Marcus Flynn', summary: 'Requested reschedule', channel: 'AI SMS ‚Üí call', timeAgo: '9 min ago' },
                { name: 'Laura Chen', summary: 'Synced with Google Calendar', channel: 'Webhook sync', timeAgo: '25 min ago' }
            ]
        };

        function getClientFromURL() {
            const params = new URLSearchParams(window.location.search);
            return (params.get('client') || DEMO_CLIENT_KEY).replace(/-/g, '_');
        }

        async function fetchLiveData(clientKey) {
            if (clientKey !== DEMO_CLIENT_KEY) {
                try {
                    const res = await fetch(`${BASE_URL}/api/demo-dashboard/${clientKey}`);
                    if (res.ok) {
                        const payload = await res.json();
                        if (payload.ok) return payload;
                    }
                } catch (err) {
                    console.warn('Live data unavailable', err.message);
                }
            }
            return null;
        }

        function mergeData(base = {}, livePayload) {
            if (!livePayload) return base;
            const metrics = livePayload.metrics || {};
            return {
                ...base,
                totalLeads: metrics.totalLeads ?? base.totalLeads,
                totalCalls: metrics.totalCalls ?? base.totalCalls,
                last24hLeads: metrics.last24hLeads ?? base.last24hLeads,
                conversionRate: metrics.conversionRate ?? base.conversionRate,
                successRate: metrics.successRate ?? base.successRate,
                recentLeads: Array.isArray(livePayload.leads) && livePayload.leads.length ? livePayload.leads : base.recentLeads,
                serviceMix: Array.isArray(livePayload.serviceMix) && livePayload.serviceMix.length ? livePayload.serviceMix : base.serviceMix,
                recentCalls: Array.isArray(livePayload.recentCalls) && livePayload.recentCalls.length ? livePayload.recentCalls : base.recentCalls
            };
        }

        function updateHeader(config) {
            document.getElementById('clientLogo').textContent = config.logo || 'üè¢';
            document.getElementById('clientName').textContent = config.name;
            document.getElementById('clientDescription').textContent = config.description || '';
            document.getElementById('clientTagline').textContent = config.tagline || '';
            document.getElementById('clientStatus').textContent = config.status || 'Live';
            document.getElementById('metaPhone').textContent = config.phone || '‚Äî';
            document.getElementById('metaTimezone').textContent = config.timezone || '‚Äî';
            document.getElementById('metaHours').textContent = config.businessHours || '‚Äî';
            document.getElementById('metaIndustry').textContent = config.industry || '‚Äî';

            const banner = document.getElementById('demoBanner');
            if (banner) {
                if (config.key === DEMO_CLIENT_KEY) {
                    banner.style.display = 'block';
                    banner.innerHTML = `<strong>Demo environment:</strong> ${config.name} shows exactly what your live dashboard will look like. When we onboard you we simply plug in your data.`;
                } else {
                    banner.style.display = 'none';
                }
            }
        }

        function formatNumber(value) {
            if (value === undefined || value === null) return '‚Äî';
            return Number(value).toLocaleString('en-GB');
        }

        function formatPercent(value) {
            if (value === undefined || value === null) return '‚Äî';
            return `${value}%`;
        }

        function updateStatusBar(data) {
            document.getElementById('statusTotalLeads').textContent = formatNumber(data.totalLeads);
            document.getElementById('statusTotalCalls').textContent = formatNumber(data.totalCalls);
            document.getElementById('statusConversionRate').textContent = formatPercent(data.conversionRate);
            document.getElementById('statusFirstResponse').textContent = data.firstResponse || '‚Äî';
        }

        function renderRecentActivity(data) {
            const container = document.getElementById('recent-activity');
            container.innerHTML = `
                <div class="metric-row"><span class="metric-label">New leads (24h)</span><span class="metric-value">${formatNumber(data.last24hLeads)}</span></div>
                <div class="metric-row"><span class="metric-label">Calls completed</span><span class="metric-value">${formatNumber(data.totalCalls)}</span></div>
                <div class="metric-row"><span class="metric-label">Appointments booked</span><span class="metric-value">${formatNumber(data.bookingsThisWeek ?? 18)}</span></div>
                <div class="metric-row"><span class="metric-label">Avg response speed</span><span class="metric-value">${data.firstResponse || '‚Äî'}</span></div>
            `;
        }

        function renderLeadPriority(data) {
            const container = document.getElementById('lead-priority');
            container.innerHTML = `
                <div class="metric-row"><span class="metric-label">High priority</span><span class="metric-value">${formatNumber(data.highPriorityLeads ?? 0)}</span></div>
                <div class="metric-row"><span class="metric-label">Medium</span><span class="metric-value">${formatNumber(data.mediumPriorityLeads ?? 0)}</span></div>
                <div class="metric-row"><span class="metric-label">Low</span><span class="metric-value">${formatNumber(data.lowPriorityLeads ?? 0)}</span></div>
                <div class="metric-row"><span class="metric-label">Avg lead score</span><span class="metric-value">${formatNumber(data.avgLeadScore ?? 0)}</span></div>
            `;
        }

        function renderLeads(leads = []) {
            const container = document.getElementById('leads-list');
            if (!leads.length) {
                container.innerHTML = '<p style="color:#8c8fab;">Leads will appear here as soon as they arrive.</p>';
                return;
            }
            container.innerHTML = leads.slice(0, 5).map(lead => `
                <div class="lead-item">
                    <div class="lead-name">${lead.name || 'Prospect'}</div>
                    <div class="lead-meta">
                        <span>${lead.phone || lead.email || ''}</span>
                        <span>${lead.service || 'General'}</span>
                    </div>
                    <div class="lead-status">${lead.status || 'In follow-up'}</div>
                </div>
            `).join('');
        }

        function renderChart(config) {
            const data = config.chart || [4, 6, 5, 7, 8, 9, 6];
            const labels = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
            const max = Math.max(...data, 1);
            const bars = data.map((value, idx) => `
                <div class="chart-bar" style="height:${(value / max) * 100}%;" data-label="${labels[idx]}"></div>
            `).join('');
            document.getElementById('chartBars').innerHTML = bars;
            document.getElementById('chartSummary').textContent = `${data.reduce((sum,v)=>sum+v,0)} touchpoints in the last 7 days`;
        }

        function renderSystemStatus(config) {
            document.getElementById('statusPhone').textContent = config.phone || '‚Äî';
            document.getElementById('statusCoverage').textContent = config.businessHours || '‚Äî';
        }

        function renderCalls(calls = []) {
            const container = document.getElementById('recent-calls');
            if (!calls.length) {
                container.innerHTML = '<p style="color:#8c8fab;">Live call feed will show up here as soon as we begin calling leads.</p>';
                return;
            }
            container.innerHTML = calls.map(call => `
                <div class="activity-item">
                    <strong>${call.name || 'Prospect'}</strong> ‚Ä¢ ${call.channel || 'AI call'}
                    <div class="activity-meta">${call.summary || 'Conversation logged'} ‚Ä¢ ${call.timeAgo || 'Just now'}</div>
                </div>
            `).join('');
        }

        function renderWorkflow(steps = []) {
            const container = document.getElementById('workflow');
            container.innerHTML = steps.map(step => `
                <li class="workflow-step">
                    <div class="workflow-icon">${step.icon}</div>
                    <div>
                        <strong>${step.title}</strong>
                        <p style="color:#6f7390; margin-top:4px;">${step.desc}</p>
                    </div>
                </li>
            `).join('');
        }

        async function initDashboard() {
            const clientKey = getClientFromURL();
            const config = { ...CLIENT_CONFIG[clientKey] } || CLIENT_CONFIG[DEMO_CLIENT_KEY];
            config.key = clientKey;
            updateHeader(config);

            let data = { ...DEMO_DATA };
            if (clientKey === DEMO_CLIENT_KEY) {
                document.getElementById('demoBanner').style.display = 'block';
            } else {
                const banner = document.getElementById('demoBanner');
                if (banner) banner.style.display = 'none';
            }

            const livePayload = await fetchLiveData(clientKey);
            data = mergeData(data, livePayload);

            updateStatusBar(data);
            renderRecentActivity(data);
            renderLeadPriority(data);
            renderLeads(data.recentLeads || []);
            renderChart(config);
            renderSystemStatus(config);
            renderCalls(data.recentCalls || []);
            renderWorkflow(config.workflow || CLIENT_CONFIG.demo_client.workflow);

            setInterval(async () => {
                const refreshPayload = await fetchLiveData(clientKey);
                if (refreshPayload) {
                    data = mergeData(data, refreshPayload);
                    updateStatusBar(data);
                    renderRecentActivity(data);
                    renderLeadPriority(data);
                    renderLeads(data.recentLeads || []);
                    renderCalls(data.recentCalls || []);
                }
            }, 30000);
        }

        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>

