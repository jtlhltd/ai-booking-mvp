<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead Input Dashboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .input-section {
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .bulk-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e1e5e9;
        }
        
        .bulk-textarea {
            height: 200px;
            font-family: monospace;
        }
        
        .example {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .import-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .manual-lead-entry {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid #e1e5e9;
        }
        
        .manual-lead-entry:last-child {
            margin-bottom: 0;
        }
        
        .btn-secondary {
            background: #6c757d;
            margin-right: 10px;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .mobile-validation {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .mobile-validation.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .mobile-validation.success {
            background: #d4edda;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìû Lead Input Dashboard</h1>
        
        <!-- Single Lead Input -->
        <div class="input-section">
            <h2>Single Lead Input</h2>
            <form id="singleLeadForm">
                <div class="form-group">
                    <label for="phoneNumber">Phone Number *</label>
                    <input type="tel" id="phoneNumber" name="phoneNumber" placeholder="+447123456789" required>
                </div>
                
                <div class="form-group">
                    <label for="decisionMaker">Decision Maker Name *</label>
                    <input type="text" id="decisionMaker" name="decisionMaker" placeholder="John Smith" required>
                </div>
                
                <div class="form-group">
                    <label for="businessName">Business Name</label>
                    <input type="text" id="businessName" name="businessName" placeholder="Tech Solutions Ltd">
                </div>
                
                <div class="form-group">
                    <label for="industry">Industry</label>
                    <select id="industry" name="industry">
                        <option value="Technology">Technology</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Consulting">Consulting</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Finance">Finance</option>
                        <option value="Retail">Retail</option>
                        <option value="Manufacturing">Manufacturing</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" name="location" placeholder="UK" value="UK">
                </div>
                
                <button type="submit" class="btn" id="singleBtn">Send SMS to Lead</button>
            </form>
        </div>
        
        <!-- Mobile-Focused Import Section -->
        <div class="bulk-section">
            <h2>üì± Mobile Number Import (100 Test Leads)</h2>
            <p><strong>Perfect for testing your pipeline with decision makers!</strong></p>
            
            <div class="form-group">
                <label for="importMethod">Import Method</label>
                <select id="importMethod" onchange="toggleImportMethod()">
                    <option value="csv">CSV Upload (Recommended)</option>
                    <option value="json">JSON Format</option>
                    <option value="manual">Manual Entry</option>
                </select>
            </div>
            
            <!-- CSV Upload Section -->
            <div id="csvSection" class="import-section">
                <h3>üìÑ CSV Upload</h3>
                <p>Upload a CSV file with your 100 mobile numbers. Download the template below:</p>
                
                <div class="example">
                    <strong>CSV Template Format:</strong><br>
                    phoneNumber,decisionMaker,businessName,industry,location<br>
                    +447123456789,John Smith,Tech Solutions Ltd,Technology,UK<br>
                    +447987654321,Sarah Jones,Marketing Pro,Marketing,UK<br>
                    +447555123456,Mike Wilson,Consulting Co,Consulting,UK
                </div>
                
                <div class="form-group">
                    <label for="csvFile">Choose CSV File</label>
                    <input type="file" id="csvFile" accept=".csv" onchange="handleCSVUpload()">
                </div>
                
                <button type="button" class="btn" id="downloadTemplate" onclick="downloadTemplate()">üì• Download CSV Template</button>
                <button type="button" class="btn" id="csvImportBtn" onclick="importCSVLeads()" disabled>üì§ Import CSV Leads</button>
            </div>
            
            <!-- JSON Section -->
            <div id="jsonSection" class="import-section" style="display: none;">
                <h3>üìã JSON Format</h3>
                <p>Paste your leads in JSON format (one per line):</p>
                
                <div class="example">
{
  "phoneNumber": "+447123456789",
  "decisionMaker": "John Smith", 
  "businessName": "Tech Solutions Ltd",
  "industry": "Technology",
  "location": "UK"
}
                </div>
                
                <textarea id="bulkLeads" class="bulk-textarea" placeholder="Paste your leads here..."></textarea>
                
                <button type="button" class="btn" id="jsonImportBtn" onclick="importBulkLeads()">üì§ Import JSON Leads</button>
            </div>
            
            <!-- Manual Entry Section -->
            <div id="manualSection" class="import-section" style="display: none;">
                <h3>‚úçÔ∏è Manual Entry</h3>
                <p>Enter leads one by one (useful for small batches):</p>
                
                <div id="manualLeadsContainer">
                    <div class="manual-lead-entry">
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" class="manual-phone" placeholder="+447123456789">
                        </div>
                        <div class="form-group">
                            <label>Decision Maker</label>
                            <input type="text" class="manual-name" placeholder="John Smith">
                        </div>
                        <div class="form-group">
                            <label>Business Name</label>
                            <input type="text" class="manual-business" placeholder="Tech Solutions Ltd">
                        </div>
                        <div class="form-group">
                            <label>Industry</label>
                            <select class="manual-industry">
                                <option value="Technology">Technology</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Consulting">Consulting</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Finance">Finance</option>
                                <option value="Retail">Retail</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Location</label>
                            <input type="text" class="manual-location" placeholder="UK" value="UK">
                        </div>
                    </div>
                </div>
                
                <button type="button" class="btn" onclick="addManualLeadEntry()">‚ûï Add Another Lead</button>
                <button type="button" class="btn" id="manualImportBtn" onclick="importManualLeads()">üì§ Import Manual Leads</button>
            </div>
        </div>
        
        <div id="status" class="status"></div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let csvData = null;
        
        // Mobile number validation
        function validateMobileNumber(phone) {
            // UK mobile number regex (starts with +44 7)
            const ukMobileRegex = /^\+44[0-9]{10}$/;
            const cleanPhone = phone.replace(/\s/g, '');
            
            if (!ukMobileRegex.test(cleanPhone)) {
                return {
                    valid: false,
                    message: 'Please enter a valid UK mobile number (e.g., +447123456789)'
                };
            }
            
            return {
                valid: true,
                message: 'Valid UK mobile number',
                formatted: cleanPhone
            };
        }
        
        // Toggle import method
        function toggleImportMethod() {
            const method = document.getElementById('importMethod').value;
            
            // Hide all sections
            document.getElementById('csvSection').style.display = 'none';
            document.getElementById('jsonSection').style.display = 'none';
            document.getElementById('manualSection').style.display = 'none';
            
            // Show selected section
            if (method === 'csv') {
                document.getElementById('csvSection').style.display = 'block';
            } else if (method === 'json') {
                document.getElementById('jsonSection').style.display = 'block';
            } else if (method === 'manual') {
                document.getElementById('manualSection').style.display = 'block';
            }
        }
        
        // Download CSV template
        function downloadTemplate() {
            const csvContent = `phoneNumber,decisionMaker,businessName,industry,location
+447123456789,John Smith,Tech Solutions Ltd,Technology,UK
+447987654321,Sarah Jones,Marketing Pro,Marketing,UK
+447555123456,Mike Wilson,Consulting Co,Consulting,UK
+447777888999,Jane Brown,Health Care Ltd,Healthcare,UK
+447111222333,Tom Davis,Finance Corp,Finance,UK
+447444555666,Lisa Green,Retail Store,Retail,UK
+447999888777,Mark White,Manufacturing Inc,Manufacturing,UK
+447333444555,Emma Black,Consulting Firm,Consulting,UK
+447666777888,David Red,Tech Startup,Technology,UK
+447222333444,Sophie Blue,Marketing Agency,Marketing,UK`;
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mobile_leads_template.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showStatus('üì• CSV template downloaded! Add your 100 mobile numbers and upload.', 'success');
        }
        
        // Handle CSV upload
        function handleCSVUpload() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csvText = e.target.result;
                    const lines = csvText.split('\n').filter(line => line.trim());
                    const headers = lines[0].split(',').map(h => h.trim());
                    
                    // Validate headers
                    const requiredHeaders = ['phoneNumber', 'decisionMaker', 'businessName', 'industry', 'location'];
                    const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));
                    
                    if (missingHeaders.length > 0) {
                        showStatus(`‚ùå Missing required columns: ${missingHeaders.join(', ')}`, 'error');
                        return;
                    }
                    
                    // Parse CSV data
                    csvData = [];
                    for (let i = 1; i < lines.length; i++) {
                        const values = lines[i].split(',').map(v => v.trim());
                        if (values.length === headers.length) {
                            const lead = {};
                            headers.forEach((header, index) => {
                                lead[header] = values[index];
                            });
                            
                            // Validate mobile number
                            const validation = validateMobileNumber(lead.phoneNumber);
                            if (validation.valid) {
                                lead.phoneNumber = validation.formatted;
                                csvData.push(lead);
                            }
                        }
                    }
                    
                    document.getElementById('csvImportBtn').disabled = false;
                    showStatus(`‚úÖ CSV loaded successfully! ${csvData.length} valid mobile numbers found.`, 'success');
                    
                } catch (error) {
                    showStatus(`‚ùå Error parsing CSV: ${error.message}`, 'error');
                }
            };
            
            reader.readAsText(file);
        }
        
        // Import CSV leads
        async function importCSVLeads() {
            if (!csvData || csvData.length === 0) {
                showStatus('‚ùå No CSV data to import', 'error');
                return;
            }
            
            const btn = document.getElementById('csvImportBtn');
            btn.disabled = true;
            btn.textContent = 'Importing...';
            
            try {
                const response = await fetch(`${API_BASE}/api/import-leads-csv`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ leads: csvData })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`‚úÖ CSV import completed! ${result.results.successful} SMS sent, ${result.results.failed} failed. Check the Lead Tracking Dashboard to monitor progress.`, 'success');
                } else {
                    showStatus(`‚ùå CSV import failed: ${result.message}`, 'error');
                }
                
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'üì§ Import CSV Leads';
            }
        }
        
        // Add manual lead entry
        function addManualLeadEntry() {
            const container = document.getElementById('manualLeadsContainer');
            const newEntry = document.createElement('div');
            newEntry.className = 'manual-lead-entry';
            newEntry.innerHTML = `
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" class="manual-phone" placeholder="+447123456789">
                </div>
                <div class="form-group">
                    <label>Decision Maker</label>
                    <input type="text" class="manual-name" placeholder="John Smith">
                </div>
                <div class="form-group">
                    <label>Business Name</label>
                    <input type="text" class="manual-business" placeholder="Tech Solutions Ltd">
                </div>
                <div class="form-group">
                    <label>Industry</label>
                    <select class="manual-industry">
                        <option value="Technology">Technology</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Consulting">Consulting</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Finance">Finance</option>
                        <option value="Retail">Retail</option>
                        <option value="Manufacturing">Manufacturing</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" class="manual-location" placeholder="UK" value="UK">
                </div>
                <button type="button" class="btn btn-secondary" onclick="removeManualLeadEntry(this)">üóëÔ∏è Remove</button>
            `;
            container.appendChild(newEntry);
        }
        
        // Remove manual lead entry
        function removeManualLeadEntry(button) {
            button.parentElement.remove();
        }
        
        // Import manual leads
        async function importManualLeads() {
            const entries = document.querySelectorAll('.manual-lead-entry');
            const leads = [];
            
            entries.forEach(entry => {
                const phone = entry.querySelector('.manual-phone').value.trim();
                const name = entry.querySelector('.manual-name').value.trim();
                const business = entry.querySelector('.manual-business').value.trim();
                const industry = entry.querySelector('.manual-industry').value;
                const location = entry.querySelector('.manual-location').value.trim();
                
                if (phone && name) {
                    const validation = validateMobileNumber(phone);
                    if (validation.valid) {
                        leads.push({
                            phoneNumber: validation.formatted,
                            decisionMaker: name,
                            businessName: business,
                            industry: industry,
                            location: location
                        });
                    }
                }
            });
            
            if (leads.length === 0) {
                showStatus('‚ùå No valid leads to import', 'error');
                return;
            }
            
            const btn = document.getElementById('manualImportBtn');
            btn.disabled = true;
            btn.textContent = 'Importing...';
            
            try {
                const response = await fetch(`${API_BASE}/api/import-leads-csv`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ leads })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`‚úÖ Manual import completed! ${result.results.successful} SMS sent, ${result.results.failed} failed.`, 'success');
                } else {
                    showStatus(`‚ùå Manual import failed: ${result.message}`, 'error');
                }
                
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'üì§ Import Manual Leads';
            }
        }
        
        // Single lead form submission
        document.getElementById('singleLeadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const leadData = Object.fromEntries(formData.entries());
            
            // Validate mobile number
            const validation = validateMobileNumber(leadData.phoneNumber);
            if (!validation.valid) {
                showStatus(`‚ùå ${validation.message}`, 'error');
                return;
            }
            
            leadData.phoneNumber = validation.formatted;
            
            const btn = document.getElementById('singleBtn');
            btn.disabled = true;
            btn.textContent = 'Sending SMS...';
            
            try {
                const response = await fetch(`${API_BASE}/api/initiate-lead-capture`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ leadData })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`‚úÖ SMS sent to ${leadData.decisionMaker} (${leadData.phoneNumber}) - Lead ID: ${result.leadId}`, 'success');
                } else {
                    showStatus(`‚ùå Failed to send SMS: ${result.message}`, 'error');
                }
                
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Send SMS to Lead';
            }
        });
        
        // Bulk import function (JSON)
        async function importBulkLeads() {
            const textarea = document.getElementById('bulkLeads');
            const leadsText = textarea.value.trim();
            
            if (!leadsText) {
                showStatus('‚ùå Please enter leads data', 'error');
                return;
            }
            
            const btn = document.getElementById('jsonImportBtn');
            btn.disabled = true;
            btn.textContent = 'Importing...';
            
            try {
                // Parse JSON lines
                const lines = leadsText.split('\n').filter(line => line.trim());
                const leads = [];
                
                lines.forEach(line => {
                    try {
                        const lead = JSON.parse(line.trim());
                        const validation = validateMobileNumber(lead.phoneNumber);
                        if (validation.valid) {
                            lead.phoneNumber = validation.formatted;
                            leads.push(lead);
                        }
                    } catch (e) {
                        throw new Error(`Invalid JSON: ${line}`);
                    }
                });
                
                const response = await fetch(`${API_BASE}/api/import-leads-csv`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ leads })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`‚úÖ JSON import completed! ${result.results.successful} SMS sent, ${result.results.failed} failed.`, 'success');
                } else {
                    showStatus(`‚ùå JSON import failed: ${result.message}`, 'error');
                }
                
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'üì§ Import JSON Leads';
            }
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 8000);
        }
    </script>
</body>
</html>
