<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Business Search - AI Booking System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: #64748b;
            font-size: 1.1rem;
        }
        
        .search-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            margin-bottom: 2rem;
        }
        
        .search-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1.5rem;
        }
        
        .search-form {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .search-input {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .search-btn {
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .search-btn:hover {
            background: #5b21b6;
            transform: translateY(-2px);
        }
        
        .search-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .search-examples {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .example-tag {
            background: #f3f4f6;
            color: #374151;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .example-tag:hover {
            background: #6366f1;
            color: white;
        }
        
        .search-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .results-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .results-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .results-count {
            background: #6366f1;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .results-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
        }
        
        .results-table tr:hover {
            background: #f8fafc;
        }
        
        .business-name {
            font-weight: 600;
            color: #1e293b;
        }
        
        .business-address {
            color: #64748b;
            font-size: 0.9rem;
        }
        
        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .phone-number {
            color: #059669;
            font-weight: 500;
        }
        
        .email-address {
            color: #3b82f6;
            font-weight: 500;
        }
        
        .website-link {
            color: #7c3aed;
            text-decoration: none;
            font-weight: 500;
        }
        
        .website-link:hover {
            text-decoration: underline;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn {
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn:hover {
            background: #5b21b6;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #f8fafc;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .btn-secondary:hover {
            background: #f1f5f9;
        }
        
        .btn-success {
            background: #10b981;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #64748b;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .export-section {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .export-info {
            color: #64748b;
            font-size: 0.9rem;
        }
        
        .export-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #6366f1;
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            color: #64748b;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .search-form {
                grid-template-columns: 1fr;
            }
            
            .search-filters {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }

        /* Decision Maker Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .decision-maker-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .contact-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .contact-info {
            flex: 1;
        }

        .contact-type {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .contact-value {
            font-size: 1.1rem;
            color: #333;
        }

        .contact-source {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .confidence-badge {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .confidence-high {
            background: #d4edda;
            color: #155724;
        }

        .confidence-medium {
            background: #fff3cd;
            color: #856404;
        }

        .confidence-low {
            background: #f8d7da;
            color: #721c24;
        }

        .outreach-strategy {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .strategy-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .strategy-item {
            margin-bottom: 8px;
            color: #555;
        }

        .loading-spinner {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üîç UK Business Search</h1>
            <p class="subtitle">Find businesses across the UK with contact details and generate leads instantly</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalSearches">0</div>
                <div class="stat-label">Total Searches</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="businessesFound">0</div>
                <div class="stat-label">Businesses Found</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="withPhone">0</div>
                <div class="stat-label">With Phone Numbers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="withEmail">0</div>
                <div class="stat-label">With Email Addresses</div>
            </div>
        </div>
        
        <div class="search-section">
            <h3 class="search-title">Search UK Businesses</h3>
            
            <div class="search-examples">
                <span class="example-tag" onclick="searchExample('dental practices')">dental practices</span>
                <span class="example-tag" onclick="searchExample('law firms')">law firms</span>
                <span class="example-tag" onclick="searchExample('beauty salons')">beauty salons</span>
                <span class="example-tag" onclick="searchExample('gardeners')">gardeners</span>
                <span class="example-tag" onclick="searchExample('plumbers')">plumbers</span>
                <span class="example-tag" onclick="searchExample('electricians')">electricians</span>
                <span class="example-tag" onclick="searchExample('restaurants')">restaurants</span>
                <span class="example-tag" onclick="searchExample('gyms')">gyms</span>
                <span class="example-tag" onclick="searchExample('vets')">vets</span>
                <span class="example-tag" onclick="searchExample('accountants')">accountants</span>
            </div>
            
            <form class="search-form" id="searchForm">
                <input type="text" class="search-input" id="searchQuery" placeholder="Enter business type (e.g., gardeners, dental practices, law firms)" required>
                <button type="submit" class="search-btn" id="searchBtn">üîç Search UK</button>
            </form>
            
            <div class="search-filters">
                <div class="filter-group">
                    <label class="filter-label">Location</label>
                    <select class="filter-select" id="locationFilter">
                        <option value="all">All UK</option>
                        <option value="london">London</option>
                        <option value="manchester">Manchester</option>
                        <option value="birmingham">Birmingham</option>
                        <option value="leeds">Leeds</option>
                        <option value="liverpool">Liverpool</option>
                        <option value="bristol">Bristol</option>
                        <option value="edinburgh">Edinburgh</option>
                        <option value="glasgow">Glasgow</option>
                        <option value="cardiff">Cardiff</option>
                        <option value="belfast">Belfast</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Business Size</label>
                    <select class="filter-select" id="sizeFilter">
                        <option value="all">Any Size</option>
                        <option value="small">Small (1-10 employees)</option>
                        <option value="medium">Medium (11-50 employees)</option>
                        <option value="large">Large (50+ employees)</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Contact Info</label>
                    <select class="filter-select" id="contactFilter">
                        <option value="all">All Results</option>
                        <option value="phone">Phone Numbers Only</option>
                        <option value="email">Email Addresses Only</option>
                        <option value="both">Phone & Email</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Results Limit</label>
                    <select class="filter-select" id="limitFilter">
                        <option value="50">50 Results</option>
                        <option value="100">100 Results</option>
                        <option value="200">200 Results</option>
                        <option value="500">500 Results</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <h3 class="results-title">Search Results</h3>
                <span class="results-count" id="resultsCount">0 businesses</span>
            </div>
            
            <div id="resultsContent">
                <!-- Results will be populated by JavaScript -->
            </div>
            
            <div class="export-section" id="exportSection" style="display: none;">
                <div class="export-info">
                    <strong id="exportCount">0</strong> businesses ready for export
                </div>
                <div class="export-buttons">
                    <button class="btn btn-secondary" onclick="exportToCSV()">üìä Export CSV</button>
                    <button class="btn btn-success" onclick="addToCRM()">‚ûï Add to CRM</button>
                    <button class="btn" onclick="sendEmailCampaign()">üìß Email Campaign</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Decision Maker Contact Research Modal -->
    <div id="decisionMakerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Decision Maker Contacts</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div id="modalContent">
                <!-- Content will be populated dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Sample UK business data
        const ukBusinesses = {
            'gardeners': [
                {
                    name: "Green Thumb Gardeners",
                    address: "123 High Street, London, SW1A 1AA",
                    phone: "+44 20 7123 4567",
                    email: "info@greenthumbgardeners.co.uk",
                    website: "https://greenthumbgardeners.co.uk",
                    employees: "5-10",
                    services: ["Garden Design", "Landscaping", "Tree Surgery"],
                    rating: 4.8
                },
                {
                    name: "Perfect Gardens Ltd",
                    address: "45 Church Road, Manchester, M1 1AA",
                    phone: "+44 161 123 4567",
                    email: "hello@perfectgardens.co.uk",
                    website: "https://perfectgardens.co.uk",
                    employees: "10-20",
                    services: ["Garden Maintenance", "Patio Installation", "Hedge Trimming"],
                    rating: 4.6
                },
                {
                    name: "Birmingham Garden Services",
                    address: "78 New Street, Birmingham, B2 4QA",
                    phone: "+44 121 123 4567",
                    email: "contact@bhamgardens.co.uk",
                    website: "https://bhamgardens.co.uk",
                    employees: "3-5",
                    services: ["Garden Clearance", "Lawn Care", "Planting"],
                    rating: 4.7
                }
            ],
            'dental practices': [
                {
                    name: "Bright Smile Dental Practice",
                    address: "12 Harley Street, London, W1G 9QD",
                    phone: "+44 20 7580 1234",
                    email: "info@brightsmile.co.uk",
                    website: "https://brightsmile.co.uk",
                    employees: "15-25",
                    services: ["General Dentistry", "Cosmetic Dentistry", "Orthodontics"],
                    rating: 4.9
                },
                {
                    name: "Manchester Dental Centre",
                    address: "34 Deansgate, Manchester, M3 2BW",
                    phone: "+44 161 123 4567",
                    email: "appointments@manchesterdental.co.uk",
                    website: "https://manchesterdental.co.uk",
                    employees: "20-30",
                    services: ["Preventive Care", "Restorative Dentistry", "Oral Surgery"],
                    rating: 4.8
                }
            ],
            'law firms': [
                {
                    name: "Thompson & Associates Solicitors",
                    address: "56 Fleet Street, London, EC4Y 1AA",
                    phone: "+44 20 7400 1234",
                    email: "info@thompsonlaw.co.uk",
                    website: "https://thompsonlaw.co.uk",
                    employees: "25-50",
                    services: ["Commercial Law", "Property Law", "Family Law"],
                    rating: 4.7
                },
                {
                    name: "Manchester Legal Group",
                    address: "89 King Street, Manchester, M2 4AH",
                    phone: "+44 161 123 4567",
                    email: "contact@manchesterlegal.co.uk",
                    website: "https://manchesterlegal.co.uk",
                    employees: "15-25",
                    services: ["Criminal Law", "Employment Law", "Personal Injury"],
                    rating: 4.6
                }
            ],
            'beauty salons': [
                {
                    name: "Glamour Studio",
                    address: "23 Oxford Street, London, W1D 2DZ",
                    phone: "+44 20 7580 1234",
                    email: "bookings@glamourstudio.co.uk",
                    website: "https://glamourstudio.co.uk",
                    employees: "8-15",
                    services: ["Hair Styling", "Beauty Treatments", "Nail Art"],
                    rating: 4.8
                },
                {
                    name: "Beauty Haven",
                    address: "67 Market Street, Manchester, M1 1PD",
                    phone: "+44 161 123 4567",
                    email: "hello@beautyhaven.co.uk",
                    website: "https://beautyhaven.co.uk",
                    employees: "5-10",
                    services: ["Facial Treatments", "Massage", "Makeup"],
                    rating: 4.7
                }
            ]
        };
        
        let currentResults = [];
        let searchCount = 0;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchForm').addEventListener('submit', handleSearch);
            loadIndustryCategories();
            updateStats();
        });

        // Load industry categories
        async function loadIndustryCategories() {
            try {
                const response = await fetch('/api/industry-categories');
                const data = await response.json();
                
                if (data.success) {
                    populateCategoryFilter(data.categories);
                }
            } catch (error) {
                console.error('Failed to load industry categories:', error);
            }
        }

        // Populate category filter
        function populateCategoryFilter(categories) {
            const categoryFilter = document.getElementById('categoryFilter');
            if (categoryFilter) {
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.value;
                    option.textContent = category.label;
                    categoryFilter.appendChild(option);
                });
            }
        }
        
        // Handle search form submission
        function handleSearch(e) {
            e.preventDefault();
            
            const query = document.getElementById('searchQuery').value.toLowerCase().trim();
            const location = document.getElementById('locationFilter').value;
            const size = document.getElementById('sizeFilter').value;
            const contact = document.getElementById('contactFilter').value;
            const limit = parseInt(document.getElementById('limitFilter').value);
            
            if (!query) {
                alert('Please enter a search term');
                return;
            }
            
            const category = document.getElementById('categoryFilter') ? document.getElementById('categoryFilter').value : '';
            const minRating = document.getElementById('minRatingFilter') ? document.getElementById('minRatingFilter').value : '';
            const sortBy = document.getElementById('sortByFilter') ? document.getElementById('sortByFilter').value : 'leadScore';
            
            performSearch(query, location, size, contact, limit, category, minRating, sortBy);
        }
        
        // Perform search
        async function performSearch(query, location, size, contact, limit, category, minRating, sortBy) {
            showLoading();
            searchCount++;
            
            try {
                const response = await fetch('/api/uk-business-search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        filters: {
                            location: location,
                            category: category,
                            minRating: minRating,
                            sortBy: sortBy,
                            limit: limit
                        }
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentResults = data.results;
                    displayResults(data.results, data.usingRealData);
                    updateStats();
                } else {
                    throw new Error(data.error || 'Search failed');
                }
            } catch (error) {
                console.error('Search error:', error);
                
                // Fallback to sample data
                let results = [];
                
                // Search through sample data
                for (const [category, businesses] of Object.entries(ukBusinesses)) {
                    if (category.includes(query) || query.includes(category)) {
                        results = results.concat(businesses);
                    }
                }
                
                // If no exact match, try partial matches
                if (results.length === 0) {
                    for (const [category, businesses] of Object.entries(ukBusinesses)) {
                        businesses.forEach(business => {
                            if (business.name.toLowerCase().includes(query) ||
                                business.services.some(service => service.toLowerCase().includes(query))) {
                                results.push(business);
                            }
                        });
                    }
                }
                
                // Apply filters
                results = applyFilters(results, location, size, contact);
                
                // Limit results
                results = results.slice(0, limit);
                
                currentResults = results;
                displayResults(results, false); // false = using sample data
                updateStats();
            }
        }
        
        // Apply filters
        function applyFilters(results, location, size, contact) {
            return results.filter(business => {
                // Location filter
                if (location !== 'all' && !business.address.toLowerCase().includes(location)) {
                    return false;
                }
                
                // Size filter
                if (size !== 'all') {
                    const employeeCount = parseInt(business.employees.split('-')[0]);
                    if (size === 'small' && employeeCount > 10) return false;
                    if (size === 'medium' && (employeeCount < 11 || employeeCount > 50)) return false;
                    if (size === 'large' && employeeCount < 51) return false;
                }
                
                // Contact filter
                if (contact !== 'all') {
                    if (contact === 'phone' && !business.phone) return false;
                    if (contact === 'email' && !business.email) return false;
                    if (contact === 'both' && (!business.phone || !business.email)) return false;
                }
                
                return true;
            });
        }
        
        // Show loading state
        function showLoading() {
            const resultsSection = document.getElementById('resultsSection');
            const resultsContent = document.getElementById('resultsContent');
            
            resultsSection.style.display = 'block';
            resultsContent.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Searching UK businesses...</p>
                </div>
            `;
        }
        
        // Display results
        function displayResults(results, usingRealData = false) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsCount = document.getElementById('resultsCount');
            const resultsContent = document.getElementById('resultsContent');
            const exportSection = document.getElementById('exportSection');
            
            resultsSection.style.display = 'block';
            resultsCount.textContent = `${results.length} businesses`;
            
            if (results.length === 0) {
                resultsContent.innerHTML = `
                    <div class="loading">
                        <p>No businesses found matching your criteria. Try adjusting your search terms or filters.</p>
                    </div>
                `;
                exportSection.style.display = 'none';
                return;
            }
            
            // Show data source indicator
            const dataSourceIndicator = document.createElement('div');
            dataSourceIndicator.style.cssText = `
                background: ${usingRealData ? '#d1fae5' : '#fef3c7'};
                border: 1px solid ${usingRealData ? '#10b981' : '#f59e0b'};
                color: ${usingRealData ? '#065f46' : '#92400e'};
                padding: 12px;
                border-radius: 8px;
                margin-bottom: 1rem;
                font-size: 0.9rem;
                display: flex;
                align-items: center;
                gap: 8px;
            `;
            
            if (usingRealData) {
                dataSourceIndicator.innerHTML = `
                    <span>‚úÖ</span>
                    <span><strong>Live Data:</strong> Results from real UK business APIs (Google Places, Companies House)</span>
                `;
            } else {
                dataSourceIndicator.innerHTML = `
                    <span>‚ö†Ô∏è</span>
                    <span><strong>Sample Data:</strong> Using demo data. <a href="API_SETUP_GUIDE.md" target="_blank" style="color: #92400e; text-decoration: underline;">Set up real APIs</a> for live business data.</span>
                `;
            }
            
            resultsContent.appendChild(dataSourceIndicator);

            // Add decision maker identification section
            const decisionMakerSection = document.createElement('div');
            decisionMakerSection.style.cssText = `
                background: #f8fafc;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                padding: 1rem;
                margin-bottom: 1rem;
            `;
            decisionMakerSection.innerHTML = `
                <h4 style="margin-bottom: 0.5rem; color: #1e293b;">üéØ Decision Maker Identification</h4>
                <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">
                    Each business result now includes decision maker roles and personalized outreach templates.
                </p>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <span style="background: #dbeafe; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">Primary Decision Makers</span>
                    <span style="background: #fef3c7; color: #92400e; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">Secondary Decision Makers</span>
                    <span style="background: #f3e8ff; color: #7c3aed; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">Gatekeepers</span>
                </div>
            `;
            resultsContent.appendChild(decisionMakerSection);
            
            const tableBody = document.createElement('tbody');
            
            results.forEach((business, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="business-name">${business.name}</div>
                        <div class="business-address">${business.address}</div>
                    </td>
                    <td>
                        <div class="contact-info">
                            ${business.phone ? `<div class="phone-number">${business.phone}</div>` : '<div style="color: #9ca3af;">No phone</div>'}
                            ${business.email ? `<div class="email-address">${business.email}</div>` : '<div style="color: #9ca3af;">No email</div>'}
                            ${business.website ? `<div><a href="${business.website}" target="_blank" class="website-link">${business.website}</a></div>` : ''}
                        </div>
                    </td>
                    <td>${business.employees} employees</td>
                    <td>${business.services.join(', ')}</td>
                    <td>‚≠ê ${business.rating}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="viewBusiness(${index})">View</button>
                            <button class="btn btn-success" onclick="addToLeads(${index})">Add Lead</button>
                            <button class="btn btn-primary" onclick="showDecisionMakers(${index})">Decision Makers</button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            resultsContent.innerHTML = `
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Business</th>
                            <th>Contact Info</th>
                            <th>Size</th>
                            <th>Services</th>
                            <th>Rating</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                </table>
            `;
            
            resultsContent.querySelector('table').appendChild(tableBody);
            
            // Show export section
            exportSection.style.display = 'flex';
            document.getElementById('exportCount').textContent = results.length;
        }
        
        // Search example
        function searchExample(example) {
            document.getElementById('searchQuery').value = example;
            document.getElementById('searchQuery').focus();
        }
        
        // Update statistics
        function updateStats() {
            document.getElementById('totalSearches').textContent = searchCount;
            document.getElementById('businessesFound').textContent = currentResults.length;
            
            const withPhone = currentResults.filter(b => b.phone).length;
            const withEmail = currentResults.filter(b => b.email).length;
            
            document.getElementById('withPhone').textContent = withPhone;
            document.getElementById('withEmail').textContent = withEmail;
        }
        
        // Action functions
        function viewBusiness(index) {
            const business = currentResults[index];
            if (business) {
                alert(`Business Details:\n\nName: ${business.name}\nAddress: ${business.address}\nPhone: ${business.phone || 'N/A'}\nEmail: ${business.email || 'N/A'}\nWebsite: ${business.website || 'N/A'}\nEmployees: ${business.employees}\nServices: ${business.services.join(', ')}\nRating: ‚≠ê ${business.rating}`);
            }
        }
        
        function addToLeads(index) {
            const business = currentResults[index];
            if (business) {
                alert(`Business "${business.name}" added to leads successfully!`);
            }
        }

        // Show decision makers for a business
        function showDecisionMakers(index) {
            const business = currentResults[index];
            const industry = categorizeBusiness(business);
            
            // Open modal and start contact research
            const modal = document.getElementById('decisionMakerModal');
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Researching decision makers for ${business.name}...</p>
                </div>
            `;
            
            modal.style.display = 'block';
            
            // Call the decision maker contact research API
            findDecisionMakerContacts(business, industry);
        }

        // Find decision maker contacts via API
        async function findDecisionMakerContacts(business, industry) {
            try {
                const response = await fetch('/api/decision-maker-contacts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        business: business,
                        industry: industry,
                        targetRole: 'primary'
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    displayDecisionMakerContacts(data);
                } else {
                    showContactResearchError(data.error || 'Failed to research contacts');
                }
            } catch (error) {
                console.error('Decision maker contact research error:', error);
                showContactResearchError('Failed to research decision maker contacts. Please try again.');
            }
        }

        // Display decision maker contacts in modal
        function displayDecisionMakerContacts(data) {
            const modalContent = document.getElementById('modalContent');
            
            let html = `
                <div class="decision-maker-section">
                    <h3 class="section-title">üéØ Primary Decision Makers</h3>
                    ${data.contacts.primary.map(contact => createContactItem(contact)).join('')}
                </div>
            `;
            
            if (data.contacts.secondary && data.contacts.secondary.length > 0) {
                html += `
                    <div class="decision-maker-section">
                        <h3 class="section-title">üë• Secondary Decision Makers</h3>
                        ${data.contacts.secondary.map(contact => createContactItem(contact)).join('')}
                    </div>
                `;
            }
            
            if (data.contacts.gatekeeper && data.contacts.gatekeeper.length > 0) {
                html += `
                    <div class="decision-maker-section">
                        <h3 class="section-title">üö™ Gatekeepers</h3>
                        ${data.contacts.gatekeeper.map(contact => createContactItem(contact)).join('')}
                    </div>
                `;
            }
            
            if (data.strategy) {
                html += `
                    <div class="outreach-strategy">
                        <h3 class="strategy-title">üìã Recommended Outreach Strategy</h3>
                        <div class="strategy-item"><strong>Approach:</strong> ${data.strategy.approach}</div>
                        <div class="strategy-item"><strong>Message:</strong> ${data.strategy.message}</div>
                        <div class="strategy-item"><strong>Follow-up:</strong> ${data.strategy.followUp}</div>
                        <div class="strategy-item"><strong>Best Time:</strong> ${data.strategy.bestTime}</div>
                    </div>
                `;
            }
            
            modalContent.innerHTML = html;
        }

        // Create contact item HTML
        function createContactItem(contact) {
            const confidenceClass = getConfidenceClass(contact.confidence);
            const confidenceText = getConfidenceText(contact.confidence);
            
            return `
                <div class="contact-item">
                    <div class="contact-info">
                        <div class="contact-type">${contact.type.toUpperCase()}</div>
                        <div class="contact-value">${contact.value}</div>
                        <div class="contact-source">Source: ${contact.source} | ${contact.title || 'Contact'}</div>
                    </div>
                    <div class="confidence-badge ${confidenceClass}">${confidenceText}</div>
                </div>
            `;
        }

        // Get confidence class for styling
        function getConfidenceClass(confidence) {
            if (confidence >= 0.8) return 'confidence-high';
            if (confidence >= 0.5) return 'confidence-medium';
            return 'confidence-low';
        }

        // Get confidence text
        function getConfidenceText(confidence) {
            if (confidence >= 0.8) return 'High';
            if (confidence >= 0.5) return 'Medium';
            return 'Low';
        }

        // Show contact research error
        function showContactResearchError(message) {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="error">
                    <h3>‚ùå Contact Research Failed</h3>
                    <p>${message}</p>
                    <p>You can try manual research methods:</p>
                    <ul>
                        <li>LinkedIn search for the business name</li>
                        <li>Company website contact page</li>
                        <li>Companies House officer search</li>
                        <li>Google search for decision maker names</li>
                    </ul>
                </div>
            `;
        }

        // Close modal
        function closeModal() {
            document.getElementById('decisionMakerModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('decisionMakerModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Legacy function for compatibility
        function getDecisionMakers(business, industry) {
            
            // Add contact finding status
            const contactStatus = document.createElement('div');
            contactStatus.style.cssText = `
                background: #f0f9ff;
                border: 1px solid #0ea5e9;
                border-radius: 8px;
                padding: 1rem;
                margin-bottom: 1rem;
            `;
            contactStatus.innerHTML = `
                <h4 style="color: #0c4a6e; margin-bottom: 0.5rem;">üìû Contact Finding Strategy</h4>
                <p style="font-size: 0.9rem; color: #0c4a6e; margin-bottom: 0.5rem;">
                    <strong>Current Status:</strong> We have the business contact details, but need to find the decision maker's personal contact information.
                </p>
                <div style="display: grid; gap: 0.5rem; font-size: 0.8rem;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: #059669;">‚úÖ</span>
                        <span>Business phone: ${business.phone || 'Not found'}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: #059669;">‚úÖ</span>
                        <span>Business email: ${business.email || 'Not found'}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: #f59e0b;">‚ö†Ô∏è</span>
                        <span>Decision maker contact: Needs research</span>
                    </div>
                </div>
                <div style="margin-top: 0.5rem; padding: 0.5rem; background: #fef3c7; border-radius: 4px; font-size: 0.8rem;">
                    <strong>Next Steps:</strong> Use the outreach templates below, but research the decision maker's personal contact details first.
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 2rem; max-width: 800px; max-height: 80vh; overflow-y: auto; margin: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: #1e293b; margin: 0;">üéØ Decision Makers for ${business.name}</h3>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #64748b;">&times;</button>
                    </div>
                    
                    ${contactStatus.outerHTML}
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: #1e293b; margin-bottom: 0.5rem;">Primary Decision Makers</h4>
                        <div style="display: grid; gap: 1rem;">
                            ${decisionMakers.filter(dm => dm.priority === 'primary').map(dm => `
                                <div style="background: #dbeafe; border: 1px solid #93c5fd; border-radius: 8px; padding: 1rem;">
                                    <div style="font-weight: 600; color: #1e40af; margin-bottom: 0.5rem;">${dm.role}</div>
                                    <div style="font-size: 0.9rem; color: #1e40af; margin-bottom: 0.5rem;">Contact Method: ${dm.contactMethod}</div>
                                    <div style="font-size: 0.9rem; color: #1e40af; margin-bottom: 0.5rem;">Approach: ${dm.approach}</div>
                                    <div style="font-size: 0.9rem; color: #1e40af;">
                                        <strong>Pain Points:</strong>
                                        <ul style="margin: 0.5rem 0 0 1rem;">
                                            ${dm.painPoints.map(point => `<li>${point}</li>`).join('')}
                                        </ul>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                        <button onclick="generateOutreach('${business.name}', '${dm.role}', '${industry}', '${dm.priority}')" 
                                                style="background: #1e40af; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                            Generate Outreach
                                        </button>
                                        <button onclick="showContactResearch('${business.name}', '${dm.role}', '${industry}')" 
                                                style="background: #059669; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                            Find Contact
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: #1e293b; margin-bottom: 0.5rem;">Secondary Decision Makers</h4>
                        <div style="display: grid; gap: 1rem;">
                            ${decisionMakers.filter(dm => dm.priority === 'secondary').map(dm => `
                                <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; padding: 1rem;">
                                    <div style="font-weight: 600; color: #92400e; margin-bottom: 0.5rem;">${dm.role}</div>
                                    <div style="font-size: 0.9rem; color: #92400e; margin-bottom: 0.5rem;">Contact Method: ${dm.contactMethod}</div>
                                    <div style="font-size: 0.9rem; color: #92400e; margin-bottom: 0.5rem;">Approach: ${dm.approach}</div>
                                    <div style="font-size: 0.9rem; color: #92400e;">
                                        <strong>Pain Points:</strong>
                                        <ul style="margin: 0.5rem 0 0 1rem;">
                                            ${dm.painPoints.map(point => `<li>${point}</li>`).join('')}
                                        </ul>
                                    </div>
                                    <button onclick="generateOutreach('${business.name}', '${dm.role}', '${industry}', '${dm.priority}')" 
                                            style="background: #92400e; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-top: 0.5rem;">
                                        Generate Outreach
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: #1e293b; margin-bottom: 0.5rem;">Gatekeepers</h4>
                        <div style="display: grid; gap: 1rem;">
                            ${decisionMakers.filter(dm => dm.priority === 'gatekeeper').map(dm => `
                                <div style="background: #f3e8ff; border: 1px solid #c4b5fd; border-radius: 8px; padding: 1rem;">
                                    <div style="font-weight: 600; color: #7c3aed; margin-bottom: 0.5rem;">${dm.role}</div>
                                    <div style="font-size: 0.9rem; color: #7c3aed; margin-bottom: 0.5rem;">Contact Method: ${dm.contactMethod}</div>
                                    <div style="font-size: 0.9rem; color: #7c3aed; margin-bottom: 0.5rem;">Approach: ${dm.approach}</div>
                                    <div style="font-size: 0.9rem; color: #7c3aed;">
                                        <strong>Pain Points:</strong>
                                        <ul style="margin: 0.5rem 0 0 1rem;">
                                            ${dm.painPoints.map(point => `<li>${point}</li>`).join('')}
                                        </ul>
                                    </div>
                                    <button onclick="generateOutreach('${business.name}', '${dm.role}', '${industry}', '${dm.priority}')" 
                                            style="background: #7c3aed; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-top: 0.5rem;">
                                        Generate Outreach
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Categorize business by industry
        function categorizeBusiness(business) {
            const name = business.name.toLowerCase();
            const services = business.services.join(' ').toLowerCase();
            
            if (name.includes('dental') || name.includes('dentist') || services.includes('dental')) return 'dental';
            if (name.includes('law') || name.includes('legal') || name.includes('solicitor') || services.includes('legal')) return 'legal';
            if (name.includes('beauty') || name.includes('salon') || name.includes('hair') || name.includes('nail') || services.includes('beauty')) return 'beauty';
            if (name.includes('medical') || name.includes('clinic') || name.includes('doctor') || name.includes('health') || services.includes('medical')) return 'medical';
            if (name.includes('gym') || name.includes('fitness') || name.includes('studio') || services.includes('fitness')) return 'fitness';
            
            return 'dental'; // Default
        }

        // Get decision makers for a business
        function getDecisionMakers(business, industry) {
            const decisionMakerRoles = {
                dental: {
                    primary: ['Practice Owner', 'Principal Dentist', 'Practice Manager'],
                    secondary: ['Office Manager', 'Reception Supervisor'],
                    gatekeepers: ['Receptionist', 'Administrative Assistant']
                },
                legal: {
                    primary: ['Managing Partner', 'Senior Partner', 'Practice Manager'],
                    secondary: ['IT Director', 'Operations Manager'],
                    gatekeepers: ['Legal Secretary', 'Paralegal']
                },
                beauty: {
                    primary: ['Salon Owner', 'Manager', 'Senior Stylist'],
                    secondary: ['Reception Manager', 'Assistant Manager'],
                    gatekeepers: ['Receptionist', 'Stylist']
                },
                medical: {
                    primary: ['Practice Manager', 'Senior Partner', 'IT Director'],
                    secondary: ['Office Manager', 'Operations Manager'],
                    gatekeepers: ['Receptionist', 'Medical Secretary']
                },
                fitness: {
                    primary: ['Gym Owner', 'Manager', 'Operations Director'],
                    secondary: ['Assistant Manager', 'Membership Manager'],
                    gatekeepers: ['Receptionist', 'Personal Trainer']
                }
            };

            const industryRoles = decisionMakerRoles[industry] || decisionMakerRoles.dental;
            const decisionMakers = [];

            // Primary decision makers
            industryRoles.primary.forEach(role => {
                decisionMakers.push({
                    role: role,
                    priority: 'primary',
                    contactMethod: 'direct',
                    approach: 'business-focused',
                    painPoints: getPainPoints(industry, role)
                });
            });

            // Secondary decision makers
            industryRoles.secondary.forEach(role => {
                decisionMakers.push({
                    role: role,
                    priority: 'secondary',
                    contactMethod: 'professional',
                    approach: 'efficiency-focused',
                    painPoints: getPainPoints(industry, role)
                });
            });

            // Gatekeepers
            industryRoles.gatekeepers.forEach(role => {
                decisionMakers.push({
                    role: role,
                    priority: 'gatekeeper',
                    contactMethod: 'friendly',
                    approach: 'relationship-building',
                    painPoints: getPainPoints(industry, role)
                });
            });

            return decisionMakers;
        }

        // Get pain points for specific roles
        function getPainPoints(industry, role) {
            const painPoints = {
                dental: {
                    'Practice Owner': [
                        'Missing 40-60% of booking opportunities',
                        'Staff spending time on phone instead of patients',
                        'Manual scheduling errors and double bookings',
                        'No-shows costing ¬£200+ per missed appointment'
                    ],
                    'Practice Manager': [
                        'Managing appointment schedules manually',
                        'Staff training on booking systems',
                        'Patient complaints about booking process',
                        'Reporting on appointment metrics'
                    ],
                    'Office Manager': [
                        'Answering phones during busy periods',
                        'Managing appointment cancellations',
                        'Following up on missed appointments',
                        'Coordinating with dental staff schedules'
                    ]
                },
                legal: {
                    'Managing Partner': [
                        'Client intake inefficiency',
                        'Missed consultation opportunities',
                        'Staff time on administrative tasks',
                        'Competition for new clients'
                    ],
                    'Practice Manager': [
                        'Managing consultation schedules',
                        'Client follow-up processes',
                        'Staff productivity metrics',
                        'Client satisfaction tracking'
                    ],
                    'IT Director': [
                        'System integration challenges',
                        'Data security compliance',
                        'Staff training on new systems',
                        'Technical support requirements'
                    ]
                },
                beauty: {
                    'Salon Owner': [
                        'Double bookings causing customer complaints',
                        'Last-minute cancellations',
                        'Staff scheduling conflicts',
                        'Revenue lost to no-shows'
                    ],
                    'Manager': [
                        'Managing stylist schedules',
                        'Customer booking preferences',
                        'Inventory management',
                        'Customer retention'
                    ],
                    'Receptionist': [
                        'Answering phones during busy periods',
                        'Managing appointment changes',
                        'Customer service complaints',
                        'Scheduling conflicts'
                    ]
                }
            };

            return painPoints[industry]?.[role] || [
                'Manual booking process',
                'Missed appointment opportunities',
                'Staff time on administrative tasks',
                'Customer service challenges'
            ];
        }

        // Generate outreach message
        function generateOutreach(businessName, role, industry, priority) {
            const templates = {
                dental: {
                    primary: `Hi [Name],

I noticed ${businessName} has been growing - that's fantastic!

But I'm curious: how many potential patients are you losing because they can't book appointments outside business hours?

Most dental practices miss 40-60% of booking opportunities because:
- Patients call when you're closed
- Staff are busy with patients during calls
- Manual scheduling creates errors

Our AI booking system has helped practices like yours:
‚úÖ Increase bookings by 300%
‚úÖ Reduce no-shows by 50%
‚úÖ Free up staff time for patient care

Would you be open to a 15-minute call to see how this could work for ${businessName}?

Best regards,
[Your Name]`,

                    secondary: `Hi [Name],

I hope this email finds you well. I'm reaching out because I noticed ${businessName} is a growing dental practice, and I believe I can help streamline your appointment booking process.

As a ${role}, you probably deal with the daily challenges of:
- Managing appointment schedules
- Training staff on booking systems
- Handling patient complaints about booking
- Reporting on appointment metrics

Our AI booking system has helped practice managers like you:
‚úÖ Reduce administrative workload by 70%
‚úÖ Improve patient satisfaction scores
‚úÖ Generate detailed booking reports
‚úÖ Integrate seamlessly with existing systems

Would you be interested in a brief 15-minute call to see how this could benefit ${businessName}?

Best regards,
[Your Name]`,

                    gatekeeper: `Hi [Name],

I hope you're having a great day! I'm reaching out because I believe I can help make your job easier at ${businessName}.

As a ${role}, you probably deal with:
- Answering phones during busy periods
- Managing appointment changes
- Customer service complaints
- Scheduling conflicts

Our AI booking system can help by:
‚úÖ Automating appointment booking 24/7
‚úÖ Reducing phone calls during busy periods
‚úÖ Preventing scheduling conflicts
‚úÖ Improving customer satisfaction

I'd love to show you how this could make your day easier. Would you be open to a brief 15-minute call?

Best regards,
[Your Name]`
                }
            };

            const template = templates[industry]?.[priority] || templates.dental.primary;
            
            // Create modal to show the outreach message
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1001;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 2rem; max-width: 600px; max-height: 80vh; overflow-y: auto; margin: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: #1e293b; margin: 0;">üìß Outreach Message for ${role} at ${businessName}</h3>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #64748b;">&times;</button>
                    </div>
                    
                    <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                        <h4 style="color: #1e293b; margin-bottom: 0.5rem;">Email Template</h4>
                        <textarea readonly style="width: 100%; height: 300px; border: 1px solid #d1d5db; border-radius: 6px; padding: 1rem; font-family: monospace; font-size: 0.9rem; resize: vertical;">${template}</textarea>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button onclick="copyToClipboard('${template.replace(/'/g, "\\'")}')" 
                                style="background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            Copy to Clipboard
                        </button>
                        <button onclick="this.closest('.modal').remove()" 
                                style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy to clipboard');
            });
        }

        // Show contact research guide
        async function showContactResearch(businessName, role, industry) {
            // Find the business data
            const business = currentResults.find(b => b.name === businessName);
            if (!business) {
                alert('Business not found');
                return;
            }
            
            // Show loading state
            const loadingModal = document.createElement('div');
            loadingModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1002;
            `;
            loadingModal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 2rem; text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: 1rem;">üîç</div>
                    <h3 style="color: #1e293b; margin-bottom: 0.5rem;">Researching Contacts...</h3>
                    <p style="color: #64748b;">Finding decision maker contact details for ${role} at ${businessName}</p>
                </div>
            `;
            document.body.appendChild(loadingModal);
            
            try {
                // Call the API to research contacts
                const response = await fetch('/api/decision-maker-contacts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        business: business,
                        industry: industry,
                        targetRole: role
                    })
                });
                
                const data = await response.json();
                
                // Remove loading modal
                loadingModal.remove();
                
                if (data.success) {
                    showContactResearchResults(data);
                } else {
                    throw new Error(data.error || 'Contact research failed');
                }
            } catch (error) {
                console.error('Contact research error:', error);
                loadingModal.remove();
                showContactResearchGuide(businessName, role, industry, error.message);
            }
        }

        // Show contact research results
        function showContactResearchResults(data) {
            const { contacts, strategy, business, industry, targetRole } = data;
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1002;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 2rem; max-width: 800px; max-height: 80vh; overflow-y: auto; margin: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: #1e293b; margin: 0;">üìû Contact Research Results</h3>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #64748b;">&times;</button>
                    </div>
                    
                    <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                        <h4 style="color: #0c4a6e; margin-bottom: 0.5rem;">üéØ Target: ${targetRole} at ${business.name}</h4>
                        <p style="font-size: 0.9rem; color: #0c4a6e;">
                            Research completed using multiple data sources and AI analysis.
                        </p>
                    </div>
                    
                    ${contacts.primary.length > 0 ? `
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: #1e293b; margin-bottom: 0.5rem;">üéØ Primary Decision Maker Contacts</h4>
                        <div style="display: grid; gap: 1rem;">
                            ${contacts.primary.map(contact => `
                                <div style="background: #dbeafe; border: 1px solid #93c5fd; border-radius: 8px; padding: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <div style="font-weight: 600; color: #1e40af;">${contact.type.toUpperCase()}</div>
                                        <div style="font-size: 0.8rem; color: #1e40af;">Confidence: ${contact.confidence}%</div>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #1e40af; margin-bottom: 0.5rem;">
                                        <strong>Contact:</strong> ${contact.value}
                                    </div>
                                    <div style="font-size: 0.8rem; color: #1e40af;">
                                        <strong>Source:</strong> ${contact.source}
                                    </div>
                                    ${contact.title ? `<div style="font-size: 0.8rem; color: #1e40af;"><strong>Title:</strong> ${contact.title}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${contacts.secondary.length > 0 ? `
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: #1e293b; margin-bottom: 0.5rem;">üìã Secondary Decision Maker Contacts</h4>
                        <div style="display: grid; gap: 1rem;">
                            ${contacts.secondary.map(contact => `
                                <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; padding: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <div style="font-weight: 600; color: #92400e;">${contact.type.toUpperCase()}</div>
                                        <div style="font-size: 0.8rem; color: #92400e;">Confidence: ${contact.confidence}%</div>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #92400e; margin-bottom: 0.5rem;">
                                        <strong>Contact:</strong> ${contact.value}
                                    </div>
                                    <div style="font-size: 0.8rem; color: #92400e;">
                                        <strong>Source:</strong> ${contact.source}
                                    </div>
                                    ${contact.title ? `<div style="font-size: 0.8rem; color: #92400e;"><strong>Title:</strong> ${contact.title}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${contacts.gatekeeper.length > 0 ? `
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: #1e293b; margin-bottom: 0.5rem;">üö™ Gatekeeper Contacts</h4>
                        <div style="display: grid; gap: 1rem;">
                            ${contacts.gatekeeper.map(contact => `
                                <div style="background: #f3e8ff; border: 1px solid #c4b5fd; border-radius: 8px; padding: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <div style="font-weight: 600; color: #7c3aed;">${contact.type.toUpperCase()}</div>
                                        <div style="font-size: 0.8rem; color: #7c3aed;">Confidence: ${contact.confidence}%</div>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #7c3aed; margin-bottom: 0.5rem;">
                                        <strong>Contact:</strong> ${contact.value}
                                    </div>
                                    <div style="font-size: 0.8rem; color: #7c3aed;">
                                        <strong>Source:</strong> ${contact.source}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: #1e293b; margin-bottom: 0.5rem;">üìà Recommended Outreach Strategy</h4>
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem;">
                            <div style="font-size: 0.9rem; color: #374151;">
                                <p><strong>Approach:</strong> ${strategy.approach}</p>
                                <p><strong>Priority:</strong> ${strategy.priority}</p>
                                <p><strong>Channels:</strong> ${strategy.channels.join(', ')}</p>
                                <p><strong>Fallback:</strong> ${strategy.fallback}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button onclick="generateOutreach('${business.name}', '${targetRole}', '${industry}', '${strategy.priority}')" 
                                style="background: #1e40af; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            Generate Outreach
                        </button>
                        <button onclick="this.closest('.modal').remove()" 
                                style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Show contact research guide (fallback)
        function showContactResearchGuide(businessName, role, industry, errorMessage = null) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1002;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 2rem; max-width: 700px; max-height: 80vh; overflow-y: auto; margin: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: #1e293b; margin: 0;">üîç How to Find ${role} Contact Details</h3>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #64748b;">&times;</button>
                    </div>
                    
                    ${errorMessage ? `
                    <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                        <h4 style="color: #dc2626; margin-bottom: 0.5rem;">‚ö†Ô∏è Research Error</h4>
                        <p style="font-size: 0.9rem; color: #dc2626;">${errorMessage}</p>
                        <p style="font-size: 0.8rem; color: #dc2626; margin-top: 0.5rem;">Using manual research guide instead.</p>
                    </div>
                    ` : ''}
                    
                    <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                        <h4 style="color: #0c4a6e; margin-bottom: 0.5rem;">üéØ Target: ${role} at ${businessName}</h4>
                        <p style="font-size: 0.9rem; color: #0c4a6e;">
                            You have the business contact details, but need to find the decision maker's personal contact information.
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: #1e293b; margin-bottom: 0.5rem;">üìã Research Methods (in order of effectiveness)</h4>
                        
                        <div style="display: grid; gap: 1rem;">
                            <div style="background: #dbeafe; border: 1px solid #93c5fd; border-radius: 8px; padding: 1rem;">
                                <h5 style="color: #1e40af; margin-bottom: 0.5rem;">1. LinkedIn Search (Most Effective)</h5>
                                <div style="font-size: 0.9rem; color: #1e40af;">
                                    <p><strong>Search:</strong> "${role}" "${businessName}" ${industry}</p>
                                    <p><strong>Look for:</strong> Direct messages, email in bio, or connection requests</p>
                                    <p><strong>Success rate:</strong> 70-80%</p>
                                </div>
                            </div>
                            
                            <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; padding: 1rem;">
                                <h5 style="color: #92400e; margin-bottom: 0.5rem;">2. Website Research</h5>
                                <div style="font-size: 0.9rem; color: #92400e;">
                                    <p><strong>Check:</strong> About page, team page, contact page</p>
                                    <p><strong>Look for:</strong> Staff photos, bios, direct contact details</p>
                                    <p><strong>Success rate:</strong> 40-60%</p>
                                </div>
                            </div>
                            
                            <div style="background: #f3e8ff; border: 1px solid #c4b5fd; border-radius: 8px; padding: 1rem;">
                                <h5 style="color: #7c3aed; margin-bottom: 0.5rem;">3. Companies House (UK Only)</h5>
                                <div style="font-size: 0.9rem; color: #7c3aed;">
                                    <p><strong>Check:</strong> Company officers and directors</p>
                                    <p><strong>Look for:</strong> Officer names and roles</p>
                                    <p><strong>Success rate:</strong> 30-50%</p>
                                </div>
                            </div>
                            
                            <div style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 1rem;">
                                <h5 style="color: #166534; margin-bottom: 0.5rem;">4. Google Search</h5>
                                <div style="font-size: 0.9rem; color: #166534;">
                                    <p><strong>Search:</strong> "${role}" "${businessName}" email contact</p>
                                    <p><strong>Look for:</strong> News articles, press releases, directories</p>
                                    <p><strong>Success rate:</strong> 20-40%</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: #1e293b; margin-bottom: 0.5rem;">üìû Contact Strategy</h4>
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem;">
                            <div style="font-size: 0.9rem; color: #374151;">
                                <p><strong>If you find personal email:</strong> Send direct email with personalized outreach</p>
                                <p><strong>If you find LinkedIn:</strong> Send connection request + follow-up message</p>
                                <p><strong>If you only have business contact:</strong> Call and ask to speak to ${role}</p>
                                <p><strong>If no contact found:</strong> Use business email with "Attention: ${role}"</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button onclick="openLinkedInSearch('${role}', '${businessName}', '${industry}')" 
                                style="background: #0077b5; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            Open LinkedIn Search
                        </button>
                        <button onclick="this.closest('.modal').remove()" 
                                style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Open LinkedIn search
        function openLinkedInSearch(role, businessName, industry) {
            const searchQuery = `${role} ${businessName} ${industry}`;
            const linkedinUrl = `https://www.linkedin.com/search/results/people/?keywords=${encodeURIComponent(searchQuery)}`;
            window.open(linkedinUrl, '_blank');
        }
        
        function exportToCSV() {
            if (currentResults.length === 0) {
                alert('No results to export');
                return;
            }
            
            const csvContent = generateCSV(currentResults);
            downloadCSV(csvContent, 'uk-businesses.csv');
            alert(`Exported ${currentResults.length} businesses to CSV`);
        }
        
        function generateCSV(results) {
            const headers = ['Name', 'Address', 'Phone', 'Email', 'Website', 'Employees', 'Services', 'Rating'];
            const csvRows = [headers.join(',')];
            
            results.forEach(business => {
                const row = [
                    `"${business.name}"`,
                    `"${business.address}"`,
                    `"${business.phone || ''}"`,
                    `"${business.email || ''}"`,
                    `"${business.website || ''}"`,
                    `"${business.employees}"`,
                    `"${business.services.join('; ')}"`,
                    business.rating
                ];
                csvRows.push(row.join(','));
            });
            
            return csvRows.join('\n');
        }
        
        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        function addToCRM() {
            if (currentResults.length === 0) {
                alert('No results to add to CRM');
                return;
            }
            alert(`Added ${currentResults.length} businesses to CRM successfully!`);
        }
        
        function sendEmailCampaign() {
            if (currentResults.length === 0) {
                alert('No results to send emails to');
                return;
            }
            alert(`Opening email campaign for ${currentResults.length} businesses...`);
        }
    </script>
</body>
</html>
