<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenant Dashboard - AI Booking MVP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .tenant-selector {
            margin-bottom: 20px;
        }
        
        .tenant-selector select {
            padding: 10px 20px;
            border: 2px solid #667eea;
            border-radius: 25px;
            background: white;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #666;
            font-weight: 500;
        }
        
        .metric-value {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .status.healthy {
            background: #d4edda;
            color: #155724;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.2s ease;
            margin: 5px;
        }
        
        .btn:hover {
            transform: scale(1.05);
        }
        
        .leads-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .lead-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }
        
        .lead-phone {
            font-weight: bold;
            color: #333;
        }
        
        .lead-status {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .lead-score {
            float: right;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .tenant-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .tenant-info h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .tenant-info p {
            color: #666;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Tenant Dashboard</h1>
            <p>Multi-tenant management for your AI Booking MVP</p>
            
            <div class="tenant-selector">
                <label for="tenantSelect">Select Tenant:</label>
                <select id="tenantSelect" onchange="switchTenant()">
                    <option value="">Loading tenants...</option>
                </select>
            </div>
            
            <div id="tenantInfo" class="tenant-info" style="display: none;">
                <h4 id="tenantName">Tenant Name</h4>
                <p><strong>Phone:</strong> <span id="tenantPhone">-</span></p>
                <p><strong>Timezone:</strong> <span id="tenantTimezone">-</span></p>
                <p><strong>Status:</strong> <span id="tenantStatus" class="status healthy">Active</span></p>
            </div>
        </div>
        
        <div class="dashboard">
            <!-- Tenant Metrics -->
            <div class="card">
                <h3>üìä Tenant Metrics</h3>
                <div id="tenant-metrics">
                    <div class="loading">Select a tenant to view metrics</div>
                </div>
            </div>
            
            <!-- Lead Management -->
            <div class="card">
                <h3>üë• Lead Management</h3>
                <div id="leads-list" class="leads-list">
                    <div class="loading">Select a tenant to view leads</div>
                </div>
            </div>
            
            <!-- SMS Configuration -->
            <div class="card">
                <h3>üì± SMS Configuration</h3>
                <div id="sms-config">
                    <div class="loading">Select a tenant to view SMS config</div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="card">
                <h3>‚ö° Quick Actions</h3>
                <button class="btn" onclick="testTenantSMS()">Test SMS</button>
                <button class="btn" onclick="refreshTenantData()">Refresh Data</button>
                <button class="btn" onclick="viewTenantLogs()">View Logs</button>
            </div>
            
            <!-- Business Hours -->
            <div class="card">
                <h3>üïí Business Hours</h3>
                <div id="business-hours">
                    <div class="loading">Select a tenant to view business hours</div>
                </div>
            </div>
            
            <!-- Performance -->
            <div class="card">
                <h3>üìà Performance</h3>
                <div id="performance-metrics">
                    <div class="loading">Select a tenant to view performance</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const API_KEY = 'ad34b1de00c5b7380d6a447abcd78874';
        const BASE_URL = 'https://ai-booking-mvp.onrender.com';
        let currentTenant = null;
        let tenants = [];
        
        async function fetchWithAuth(url) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'X-API-Key': API_KEY,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }
        
        async function fetchPublic(url) {
            try {
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }
        
        async function loadTenants() {
            try {
                // Try to load from public health endpoint first
                const health = await fetchPublic(`${BASE_URL}/health`);
                
                // Use hardcoded tenant data for demo
                tenants = ['victory_dental', 'northside_vet'];
                
                const select = document.getElementById('tenantSelect');
                select.innerHTML = '<option value="">Select a tenant...</option>';
                
                tenants.forEach(tenantKey => {
                    const option = document.createElement('option');
                    option.value = tenantKey;
                    option.textContent = getTenantDisplayName(tenantKey);
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Failed to load tenants:', error);
                // Fallback to hardcoded tenants
                tenants = ['victory_dental', 'northside_vet'];
                const select = document.getElementById('tenantSelect');
                select.innerHTML = '<option value="">Select a tenant...</option>';
                
                tenants.forEach(tenantKey => {
                    const option = document.createElement('option');
                    option.value = tenantKey;
                    option.textContent = getTenantDisplayName(tenantKey);
                    select.appendChild(option);
                });
            }
        }
        
        function getTenantDisplayName(tenantKey) {
            const names = {
                'victory_dental': 'Victory Dental',
                'northside_vet': 'Northside Vet'
            };
            return names[tenantKey] || tenantKey;
        }
        
        async function switchTenant() {
            const tenantKey = document.getElementById('tenantSelect').value;
            if (!tenantKey) {
                currentTenant = null;
                document.getElementById('tenantInfo').style.display = 'none';
                return;
            }
            
            currentTenant = tenantKey;
            await loadTenantData();
        }
        
        async function loadTenantData() {
            if (!currentTenant) return;
            
            try {
                // Use demo data for now (no authentication required)
                const tenantData = getDemoTenantData(currentTenant);
                
                // Update tenant info
                document.getElementById('tenantInfo').style.display = 'block';
                document.getElementById('tenantName').textContent = tenantData.displayName;
                document.getElementById('tenantPhone').textContent = tenantData.phone;
                document.getElementById('tenantTimezone').textContent = tenantData.timezone;
                document.getElementById('tenantStatus').textContent = 'Active';
                document.getElementById('tenantStatus').className = 'status healthy';
                
                // Update tenant metrics
                document.getElementById('tenant-metrics').innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Total Leads</span>
                        <span class="metric-value">${tenantData.totalLeads}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Total Calls</span>
                        <span class="metric-value">${tenantData.totalCalls}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Last 24h Leads</span>
                        <span class="metric-value">${tenantData.last24hLeads}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Conversion Rate</span>
                        <span class="metric-value">${tenantData.conversionRate}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Success Rate</span>
                        <span class="metric-value">${tenantData.successRate}%</span>
                    </div>
                `;
                
                // Update performance metrics
                document.getElementById('performance-metrics').innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Avg Lead Score</span>
                        <span class="metric-value">${tenantData.avgLeadScore}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">High Priority</span>
                        <span class="metric-value">${tenantData.highPriorityLeads}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Medium Priority</span>
                        <span class="metric-value">${tenantData.mediumPriorityLeads}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Low Priority</span>
                        <span class="metric-value">${tenantData.lowPriorityLeads}</span>
                    </div>
                `;
                
                // Update SMS config
                document.getElementById('sms-config').innerHTML = `
                    <div class="metric">
                        <span class="metric-label">From Number</span>
                        <span class="metric-value">${tenantData.phone}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Messaging Service</span>
                        <span class="metric-value">MG852f3cf7b50ef1be50c566be9e7efa04</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Status</span>
                        <span class="status healthy">Active</span>
                    </div>
                `;
                
                // Update business hours
                document.getElementById('business-hours').innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Timezone</span>
                        <span class="metric-value">${tenantData.timezone}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Hours</span>
                        <span class="metric-value">9AM - 5PM</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Days</span>
                        <span class="metric-value">Mon - Fri</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Current Status</span>
                        <span class="status ${isBusinessHours() ? 'healthy' : 'warning'}">${isBusinessHours() ? 'Open' : 'Closed'}</span>
                    </div>
                `;
                
                // Update leads
                document.getElementById('leads-list').innerHTML = tenantData.leads.map(lead => `
                    <div class="lead-item">
                        <div class="lead-phone">${lead.phone}</div>
                        <div class="lead-status">Status: ${lead.status} ‚Ä¢ Last: ${lead.lastMessage}</div>
                        <div class="lead-score">Score: ${lead.score}</div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Failed to load tenant data:', error);
                document.getElementById('tenant-metrics').innerHTML = `
                    <div class="error">Failed to load tenant data: ${error.message}</div>
                `;
            }
        }
        
        function getDemoTenantData(tenantKey) {
            const data = {
                'victory_dental': {
                    displayName: 'Victory Dental',
                    phone: '+447403934440',
                    timezone: 'Europe/London',
                    totalLeads: 1,
                    totalCalls: 0,
                    last24hLeads: 1,
                    conversionRate: 0,
                    successRate: 100,
                    avgLeadScore: 80,
                    highPriorityLeads: 1,
                    mediumPriorityLeads: 0,
                    lowPriorityLeads: 0,
                    leads: [
                        {
                            phone: '+447491683261',
                            status: 'engaged',
                            lastMessage: 'START message',
                            score: 80
                        }
                    ]
                },
                'northside_vet': {
                    displayName: 'Northside Vet',
                    phone: '+447491683261',
                    timezone: 'Europe/London',
                    totalLeads: 0,
                    totalCalls: 0,
                    last24hLeads: 0,
                    conversionRate: 0,
                    successRate: 100,
                    avgLeadScore: 0,
                    highPriorityLeads: 0,
                    mediumPriorityLeads: 0,
                    lowPriorityLeads: 0,
                    leads: []
                }
            };
            return data[tenantKey] || data['victory_dental'];
        }
        
        function getTenantPhone(tenantKey) {
            const phoneMap = {
                'victory_dental': '+447403934440',
                'northside_vet': '+447491683261'
            };
            return phoneMap[tenantKey] || 'Unknown';
        }
        
        function isBusinessHours() {
            const now = new Date();
            const hour = now.getHours();
            const day = now.getDay();
            return day >= 1 && day <= 5 && hour >= 9 && hour < 17;
        }
        
        function testTenantSMS() {
            if (!currentTenant) {
                alert('Please select a tenant first');
                return;
            }
            
            const phone = getTenantPhone(currentTenant);
            alert(`SMS Test for ${currentTenant}:\n\nSend "START" to:\n${phone}\n\nCheck logs for [AUTO-CALL TRIGGER] or [AUTO-CALL DEFERRED]`);
        }
        
        function refreshTenantData() {
            if (currentTenant) {
                loadTenantData();
            }
        }
        
        function viewTenantLogs() {
            window.open('https://dashboard.render.com/web/srv-d2vvdqbuibrs73dq57ug/logs', '_blank');
        }
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            if (currentTenant) {
                loadTenantData();
            }
        }, 30000);
        
        // Load tenants on page load
        document.addEventListener('DOMContentLoaded', loadTenants);
    </script>
</body>
</html>
